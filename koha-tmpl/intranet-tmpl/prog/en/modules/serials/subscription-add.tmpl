<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Serials &rsaquo; <!-- TMPL_IF name="mod" --> Modify subscription to <!-- TMPL_VAR name="bibliotitle" --><!-- TMPL_ELSE -->New subscription<!-- /TMPL_IF --></title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<!-- TMPL_INCLUDE NAME="calendar.inc" -->

<script type="text/javascript">

var globalnumpatterndata;
var globalfreqdata;
var advancedpatternlocked;
var patternneedtobetested = 0;

function isDefined(variable){
    return (typeof(window[variable]) == 'undefined')? false : true;
}

function isArray(obj) {
if (obj.constructor.toString().indexOf("Array") == -1)
    return false;
else
    return true;
}

function check_issues(){
    if (globalfreqdata.unit.length >0) {
        if (document.f.subtype.value == globalfreqdata.unit){
            document.f.issuelengthcount.value=(document.f.sublength.value*globalfreqdata.issuesperunit)/globalfreqdata.unitsperissue;
        } else if (document.f.subtype.value != "issues"){
            alert(_("Frequency and subscription length provided doesn't combine well. Please consider entering an issue count rather than a time period."));
        }
    }
}

function addbiblioPopup(biblionumber) {
    var destination = "/cgi-bin/koha/cataloguing/addbiblio.pl?mode=popup";
    if(biblionumber){
        destination += "&biblionumber="+biblionumber;
    }
    window.open(destination,'AddBiblioPopup','width=1024,height=768,toolbar=no,scrollbars=yes');
}

function Plugin(f)
{
    window.open('subscription-bib-search.pl','FindABibIndex','width=800,height=400,toolbar=no,scrollbars=yes');
}

function FindAcqui(f)
{
    window.open('acqui-search.pl','FindASupplier','width=800,height=400,toolbar=no,scrollbars=yes');
}

function Find_ISSN(f)
{
    window.open('issn-search.pl','FindABibIndex','width=800,height=400,toolbar=no,scrollbars=yes');
}

function Clear(id) {
    $("#"+id).val('');
}

function Check_page1() {
    if ( $("#aqbooksellerid").val().length == 0) {
        input_box = confirm(_("If you wish to claim late or missing issues you must link this subscription to a vendor. Click OK to ignore or Cancel to return and enter a vendor"));
        if (input_box==false) {
            return false;
        }
    }
    if ($("#biblionumber").val().length == 0) {
        alert(_("You must choose or create a biblio"));
        return false;
    }

    return true;
}

function Check_page2(){
    <!-- TMPL_UNLESS NAME='more_than_one_serial' -->
      if($("#acqui_date").val().length == 0){
          alert(_("You must choose a first publication date"));
          return false;
      }
    <!-- /TMPL_UNLESS -->
    if($("#frequency").val().length == 0){
        alert(_("You must choose a frequency"));
        return false;
    }
    if($("#beginning_date").val().length == 0){
        alert(_("You must choose a start date"));
        return false;
    }
    if(($("#sublength").val().length == 0 && $("#enddate").val().length == 0)){
        alert(_("You must choose a subscription length or an end date."));
        return false;
    }
    if(advancedpatternlocked == 0){
        alert(_("You have modified the advanced prediction pattern. Please save your work or cancel modifications."));
        return false;
    }
    if(patternneedtobetested){
        alert(_("Please click on 'Test prediction pattern' before saving subscription."));
        return false;
    }

    return true;
}

function frequencyload(){
    $.getJSON("subscription-frequency.pl",{"frequency_id":document.f.frequency.value,ajax:'true'},
        function(freqdata){
            globalfreqdata=freqdata;
            if ( globalfreqdata.unit.length == 0 ) {
                var option = $("#subtype option[value='issues']");
                $(option).attr('selected', 'selected');
                $("#subtype option[value!='issues']").attr('disabled', 'disabled')
            } else {
                $("#subtype option").attr('disabled', '')
            }
        }
    )
}

function numberpatternload(){
    $.getJSON("subscription-numberpattern.pl",{"numberpattern_id":document.f.numbering_pattern.value,ajax:'true'},
        function(numpatterndata){
            globalnumpatterndata=numpatterndata;
            if (globalnumpatterndata==undefined){
                return false;
            }
            displaymoreoptions();
            restoreAdvancedPattern();
        }
    );
}

function displaymoreoptions() {
    if(globalnumpatterndata == undefined){
        $("#moreoptionst").hide();
        return false;
    }

    var X = 0, Y = 0, Z = 0;
    var numberingmethod = unescape(globalnumpatterndata.numberingmethod);
    if(numberingmethod.match(/{X}/)) X = 1;
    if(numberingmethod.match(/{Y}/)) Y = 1;
    if(numberingmethod.match(/{Z}/)) Z = 1;

    if(X || Y || Z) {
        $("#moreoptionst").show();
    } else {
        $("#moreoptionst").hide();
    }

    if(X) {
        if(globalnumpatterndata.label1) {
            $("#headerX").html(unescape(globalnumpatterndata.label1));
        } else {
            $("#headerX").html("X");
        }
        $("#headerX").show();
        $("#beginsX").show();
        $("#innerX").show();
    } else {
        $("#headerX").hide();
        $("#beginsX").hide();
        $("#innerX").hide();
        $("#lastvaluetemp1").val('');
        $("#innerlooptemp1").val('');
    }
    if(Y) {
        if(globalnumpatterndata.label2) {
            $("#headerY").html(unescape(globalnumpatterndata.label2));
        } else {
            $("#headerY").html("Y");
        }
        $("#headerY").show();
        $("#beginsY").show();
        $("#innerY").show();
    } else {
        $("#headerY").hide();
        $("#beginsY").hide();
        $("#innerY").hide();
        $("#lastvaluetemp2").val('');
        $("#innerlooptemp2").val('');
    }
    if(Z) {
        if(globalnumpatterndata.label3) {
            $("#headerZ").html(unescape(globalnumpatterndata.label3));
        } else {
            $("#headerZ").html("Z");
        }
        $("#headerZ").show();
        $("#beginsZ").show();
        $("#innerZ").show();
    } else {
        $("#headerZ").hide();
        $("#beginsZ").hide();
        $("#innerZ").hide();
        $("#lastvaluetemp3").val('');
        $("#innerlooptemp3").val('');
    }
}

function toggleAdvancedPattern() {
    $("#advancedpredictionpattern").toggle();
}

function modifyAdvancedPattern() {
    $("#patternname").attr("readonly", false).val('');
    $("#numberingmethod").attr("readonly", false);
    $("#label1").attr("readonly", false);
    $("#label2").attr("readonly", false);
    $("#label3").attr("readonly", false);
    $("#lastvalue1").attr("readonly", false);
    $("#lastvalue2").attr("readonly", false);
    $("#lastvalue3").attr("readonly", false);
    $("#add1").attr("readonly", false);
    $("#add2").attr("readonly", false);
    $("#add3").attr("readonly", false);
    $("#every1").attr("readonly", false);
    $("#every2").attr("readonly", false);
    $("#every3").attr("readonly", false);
    $("#innerloop1").attr("readonly", false);
    $("#innerloop2").attr("readonly", false);
    $("#innerloop3").attr("readonly", false);
    $("#setto1").attr("readonly", false);
    $("#setto2").attr("readonly", false);
    $("#setto3").attr("readonly", false);
    $("#whenmorethan1").attr("readonly", false);
    $("#whenmorethan2").attr("readonly", false);
    $("#whenmorethan3").attr("readonly", false);
    $("#numbering1").attr("readonly", false);
    $("#numbering2").attr("readonly", false);
    $("#numbering3").attr("readonly", false);

    $("#restoreadvancedpatternbutton").show();
    $("#saveadvancedpatternbutton").show();
    $("#modifyadvancedpatternbutton").hide();

    advancedpatternlocked = 0;
}

function restoreAdvancedPattern() {
    $("#patternname").attr("readonly", true).val(unescape(globalnumpatterndata.label));
    $("#numberingmethod").attr("readonly", true).val(unescape(globalnumpatterndata.numberingmethod));
    $("#label1").attr("readonly", true).val(unescape(globalnumpatterndata.label1));
    $("#label2").attr("readonly", true).val(unescape(globalnumpatterndata.label2));
    $("#label3").attr("readonly", true).val(unescape(globalnumpatterndata.label3));
    $("#lastvalue1").attr("readonly", true).val($("#lastvaluetemp1").val());
    $("#lastvalue2").attr("readonly", true).val($("#lastvaluetemp2").val());
    $("#lastvalue3").attr("readonly", true).val($("#lastvaluetemp3").val());
    $("#add1").attr("readonly", true).val(globalnumpatterndata.add1);
    $("#add2").attr("readonly", true).val(globalnumpatterndata.add2);
    $("#add3").attr("readonly", true).val(globalnumpatterndata.add3);
    $("#every1").attr("readonly", true).val(globalnumpatterndata.every1);
    $("#every2").attr("readonly", true).val(globalnumpatterndata.every2);
    $("#every3").attr("readonly", true).val(globalnumpatterndata.every3);
    $("#innerloop1").attr("readonly", true).val($("#innerlooptemp1").val());
    $("#innerloop2").attr("readonly", true).val($("#innerlooptemp2").val());
    $("#innerloop3").attr("readonly", true).val($("#innerlooptemp3").val());
    $("#setto1").attr("readonly", true).val(globalnumpatterndata.setto1);
    $("#setto2").attr("readonly", true).val(globalnumpatterndata.setto2);
    $("#setto3").attr("readonly", true).val(globalnumpatterndata.setto3);
    $("#whenmorethan1").attr("readonly", true).val(globalnumpatterndata.whenmorethan1);
    $("#whenmorethan2").attr("readonly", true).val(globalnumpatterndata.whenmorethan2);
    $("#whenmorethan3").attr("readonly", true).val(globalnumpatterndata.whenmorethan3);
    $("#numbering1").attr("readonly", true).val(globalnumpatterndata.numbering1);
    $("#numbering2").attr("readonly", true).val(globalnumpatterndata.numbering2);
    $("#numbering3").attr("readonly", true).val(globalnumpatterndata.numbering3);

    $("#restoreadvancedpatternbutton").hide();
    $("#saveadvancedpatternbutton").hide();
    $("#modifyadvancedpatternbutton").show();

    advancedpatternlocked = 1;
}

function testPredictionPattern() {
    var frequencyid = $("#frequency").val();
    var acquidate;
    var error = 0;
    var error_msg = "";
    if(frequencyid == undefined || frequencyid == ""){
        error_msg += _("- Frequency is not defined\n");
        error ++;
    }
    <!-- TMPL_IF NAME='more_than_one_serial' -->
      acquidate = $("#nextacquidate").val();
      if(acquidate == undefined || acquidate == ""){
        error_msg += _("- Next issue publication date is not defined\n");
        error ++;
      }
    <!-- TMPL_ELSE -->
      acquidate = $("#acqui_date").val();
      if(acquidate == undefined || acquidate == ""){
          error_msg += _("- First publication date is not defined\n");
          error ++;
      }
    <!-- /TMPL_IF -->

    if(error){
        alert(_("Cannot test prediction pattern for the following reason(s):\n\n")
            + error_msg);
        return false;
    }

    var custompattern = 0;
    if(advancedpatternlocked == 0) {
        custompattern = 1;
    }

    $.ajax({
        url: "showpredictionpattern.pl",
        data: {
            'custompattern' : custompattern,
            <!-- TMPL_IF NAME='mod' -->
              'subscriptionid': $("input[name='subscriptionid']").val(),
            <!-- /TMPL_IF -->
            'firstacquidate': acquidate,
            'enddate'       : $("#enddate").val(),
            'subtype'       : $("#subtype").val(),
            'sublength'     : $("#sublength").val(),
            'frequency'     : $("#frequency").val(),
            'numberingmethod' : $("#numberingmethod").val(),
            'lastvalue1'    : $("#lastvalue1").val(),
            'lastvalue2'    : $("#lastvalue2").val(),
            'lastvalue3'    : $("#lastvalue3").val(),
            'add1'          : $("#add1").val(),
            'add2'          : $("#add2").val(),
            'add3'          : $("#add3").val(),
            'every1'        : $("#every1").val(),
            'every2'        : $("#every2").val(),
            'every3'        : $("#every3").val(),
            'innerloop1'    : $("#innerloop1").val(),
            'innerloop2'    : $("#innerloop2").val(),
            'innerloop3'    : $("#innerloop3").val(),
            'setto1'        : $("#setto1").val(),
            'setto2'        : $("#setto2").val(),
            'setto3'        : $("#setto3").val(),
            'whenmorethan1' : $("#whenmorethan1").val(),
            'whenmorethan2' : $("#whenmorethan2").val(),
            'whenmorethan3' : $("#whenmorethan3").val(),
            'numbering1'    : $("#numbering1").val(),
            'numbering2'    : $("#numbering2").val(),
            'numbering3'    : $("#numbering3").val()
        },
        async: false,
        dataType: "text",
        success: function(data) {
            $("#displayexample").html(data);
            patternneedtobetested = 0;
        }
    });
}

function saveAdvancedPattern() {
    // Check if patternname already exists, and modify pattern
    // instead of creating it if so
    var found = 0;
    $("#numberpattern option").each(function(){
        if($(this).text() == $("#patternname").val()){
            found = 1;
            return false;
        }
    });
    var cnfrm = 1;
    if(found){
        cnfrm = confirm(_("This pattern already exists. Do you want to modify it"));
    }

    if(cnfrm) {
        $.getJSON("create-numberpattern.pl",{
                "patternname"   :$("#patternname").val(),
                "numberingmethod":$("#numberingmethod").val(),
                "label1"        :$("#label1").val(),
                "label2"        :$("#label2").val(),
                "label3"        :$("#label3").val(),
                "add1"          :$("#add1").val(),
                "add2"          :$("#add2").val(),
                "add3"          :$("#add3").val(),
                "every1"        :$("#every1").val(),
                "every2"        :$("#every2").val(),
                "every3"        :$("#every3").val(),
                "setto1"        :$("#setto1").val(),
                "setto2"        :$("#setto2").val(),
                "setto3"        :$("#setto3").val(),
                "whenmorethan1" :$("#whenmorethan1").val(),
                "whenmorethan2" :$("#whenmorethan2").val(),
                "whenmorethan3" :$("#whenmorethan3").val(),
                "numbering1"    :$("#numbering1").val(),
                "numbering2"    :$("#numbering2").val(),
                "numbering3"    :$("#numbering3").val(),
                ajax:'true'
            },
            function(data){
                if(found == 0){
                    $("#numberpattern").append("<option value=\""+data.numberpatternid+"\">"+$("#patternname").val()+"</option>");
                }
                $("#numberpattern").val(data.numberpatternid);
                numberpatternload();
            }
        );
    }
}

function show_page_1() {
    $("#page_1").show();
    $("#page_2").hide();
    $("#page_number").text("1/2");
}
function show_page_2() {
    $("#page_1").hide();
    $("#page_2").show();
    $("#page_number").text("2/2");
    displaymoreoptions();
}


$(document).ready(function() {
    $("select#frequency").change(function(){
        patternneedtobetested = 1;
        frequencyload();
    });
    $("select#numberpattern").change(function(){
        patternneedtobetested = 1;
        numberpatternload();
    });
    $("#lastvaluetemp1").keyup(function(){
        $("#lastvalue1").val($(this).val());
    });
    $("#lastvaluetemp2").keyup(function(){
        $("#lastvalue2").val($(this).val());
    });
    $("#lastvaluetemp3").keyup(function(){
        $("#lastvalue3").val($(this).val());
    });
    $("#lastvalue1").keyup(function(){
        $("#lastvaluetemp1").val($(this).val());
    });
    $("#lastvalue2").keyup(function(){
        $("#lastvaluetemp2").val($(this).val());
    });
    $("#lastvalue3").keyup(function(){
        $("#lastvaluetemp3").val($(this).val());
    });

    $("#innerlooptemp1").keyup(function(){
        $("#innerloop1").val($(this).val());
    });
    $("#innerlooptemp2").keyup(function(){
        $("#innerloop2").val($(this).val());
    });
    $("#innerlooptemp3").keyup(function(){
        $("#innerloop3").val($(this).val());
    });
    $("#innerloop1").keyup(function(){
        $("#innerlooptemp1").val($(this).val());
    });
    $("#innerloop2").keyup(function(){
        $("#innerlooptemp2").val($(this).val());
    });
    $("#innerloop3").keyup(function(){
        $("#innerlooptemp3").val($(this).val());
    });

    if($("#frequency").val() != ""){
        frequencyload();
    }
    if($("#numberpattern").val() != ""){
        numberpatternload();
    }

    show_page_1();
});
</script>
</head>
<body>
<!-- TMPL_INCLUDE NAME="header.inc" -->
<!-- TMPL_INCLUDE NAME="serials-search.inc" -->

<div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/serials/serials-home.pl">Serials</a> &rsaquo; <!-- TMPL_IF name="mod" --> Modify subscription for <span class="title"><!-- TMPL_VAR name="bibliotitle" --></span><!-- TMPL_ELSE -->New subscription<!-- /TMPL_IF --></div>

<div id="doc3" class="yui-t7">
    <div id="bd">
        <div class="yui-g">
            <h1><!-- TMPL_IF name="mod" --> Modify subscription for <i><!-- TMPL_VAR name="bibliotitle" --></i><!-- TMPL_ELSE -->Add a new subscription<!-- /TMPL_IF --> (<span id="page_number">1/2</span>)</h1>
            <form method="post" name="f" action="/cgi-bin/koha/serials/subscription-add.pl">
                <!-- TMPL_IF name="mod" -->
                    <input type="hidden" name="op" value="modsubscription" />
                    <input type="hidden" name="subscriptionid" value="<!-- TMPL_VAR name="subscriptionid" -->" />
                <!-- TMPL_ELSE -->
                    <input type="hidden" name="op" value="addsubscription" />
                <!-- /TMPL_IF -->
                <input type="hidden" name="user" value="<!-- TMPL_VAR name="loggedinusername" -->" />
                <input type="hidden" name="irreg_check" value="0" />

                <div id="page_1">
                    <div class="yui-u first">
                        <fieldset id="subscription_add_information" class="rows">
                            <legend>Subscription details</legend>
                            <ol>
                                <li><span class="label">Subscription #</span> <!--TMPL_VAR name="subscriptionid"--></li>
                                <li>
                                    <span class="label">Librarian: </span>            <!-- TMPL_VAR name="loggedinusername" -->
                                </li>
                                <li>
                                    <label for="aqbooksellerid">Vendor: </label>
                                    <input type="text" name="aqbooksellerid" id="aqbooksellerid" value="<!-- TMPL_VAR name="aqbooksellerid" -->" size="8" /> (<input type="text" name="aqbooksellername" value="<!-- TMPL_VAR name="aqbooksellername" -->" disabled="disabled" readonly="readonly" />) <a href="#" onclick="FindAcqui(f)">Search for a vendor</a>
                                </li>
                                <li>
                                    <label for="biblionumber">Biblio: (*)</label>
                                    <input type="text" name="biblionumber" id="biblionumber" value="<!-- TMPL_VAR name="bibnum" -->" size="8" />
                                    (<input type="text" name="title" value="<!-- TMPL_VAR name="bibliotitle" -->" disabled="disabled" readonly="readonly" />)
                                    <a href="#" onclick="Plugin(f)">Search for Biblio</a> | <!--TMPL_IF Name="mod"--><a href="#" onclick="addbiblioPopup(<!-- TMPL_VAR NAME="bibnum" -->); return false;">Edit biblio</a><!-- TMPL_ELSE -->
                                    <a href="#" onclick="addbiblioPopup(); return false;">Create Biblio</a><!--/TMPL_IF-->
                                </li>
                                <li class="radio">
                                    <!-- TMPL_IF name="serialsadditems" -->
                                        <p><input type="radio" id="serialsadditems-yes" name="serialsadditems" value="1" checked="checked" /><label for="serialsadditems-yes">create an item record when receiving this serial</label></p>
                                        <p><input type="radio" id="serialsadditems-no" name="serialsadditems" value="0" /><label for="serialsadditems-no">do not create an item record when receiving this serial </label></p>
                                    <!-- TMPL_ELSE -->
                                        <p><input type="radio" id="serialsadditems-yes" name="serialsadditems" value="1"/><label for="serialsadditems-yes">create an item record when receiving this serial</label></p>
                                        <p><input type="radio" id="serialsadditems-no" name="serialsadditems" value="0" checked="checked" /><label for="serialsadditems-no">do not create an item record when receiving this serial</label></p>
                                    <!-- /TMPL_IF -->
                                </li>
                                <li>
                                    <label for="callnumber">Call Number</label>
                                    <input type="text" name="callnumber" id="callnumber" value="<!-- TMPL_VAR name="callnumber" -->" size="20" />
                                </li>
                                <li>
                                    <label for="branchcode">Library</label>
                                    <select name="branchcode" id="branchcode" style="width: 20em;">
                                        <!-- TMPL_UNLESS NAME="Independantbranches" --><option value="">None</option><!-- /TMPL_UNLESS -->
                                        <!-- TMPL_LOOP name="branchloop" -->
                                            <!-- TMPL_IF NAME="selected" -->
                                                <option value="<!-- TMPL_VAR NAME="value" -->" selected="selected"><!-- TMPL_VAR NAME="branchname" --></option>
                                            <!-- TMPL_ELSE -->
                                                <option value="<!-- TMPL_VAR NAME="value" -->"><!-- TMPL_VAR NAME="branchname" --></option>
                                            <!-- /TMPL_IF -->
                                        <!-- /TMPL_LOOP -->
                                    </select> (select a library)
                                </li>
                                <li>
                                    <label for="notes">Public note</label>
                                    <textarea name="notes" id="notes" cols="30" rows="2"><!-- TMPL_VAR name="notes" --></textarea>
                                </li>
                                <li>
                                    <label for="internalnotes">Nonpublic note</label>
                                    <textarea name="internalnotes" id="internalnotes" cols="30" rows="2"><!-- TMPL_VAR name="internalnotes" --></textarea>
                                </li>
                                <li>
                                    <label for="letter">Patron notification </label>
                                    <!-- TMPL_IF NAME="letterloop" -->
                                       <select name="letter" id="letter">
                                            <option value="">None</option>
                                            <!-- TMPL_LOOP name="letterloop" -->
                                                <option value="<!-- TMPL_VAR name="value" -->" <!-- TMPL_IF name="selected" --> selected="selected" <!-- /TMPL_IF -->><!-- TMPL_VAR name="lettername" --></option>
                                            <!-- /TMPL_LOOP -->
                                        </select>
                                        <div class="inputnote">Select a notice and patrons on the routing list will be notified when new issues are received.</div>
                                    <!-- TMPL_ELSE -->
                                        <div class="inputnote">To notify patrons of new serial issues, you must <a href="/cgi-bin/koha/tools/letter.pl">define a notice</a>.</div>
                                    <!-- /TMPL_IF -->
                                </li>
                                <li>
                                    <label for="graceperiod">Grace period (days)</label>
                                    <input type="text" name="graceperiod" id="graceperiod" value="<!-- TMPL_VAR name="graceperiod" -->" size="20" />
                                </li>
                                <li>
                                    <label for="staffdisplaycount">Number of issues to display to staff</label>
                                    <input type="text" name="staffdisplaycount" id="staffdisplaycount" value="<!-- TMPL_VAR name="staffdisplaycount" -->" size="20" />
                                </li>
                                <li>
                                    <label for="opacdisplaycount">Number of issues to display to the public</label>
                                    <input type="text" name="opacdisplaycount" id="opacdisplaycount" value="<!-- TMPL_VAR name="opacdisplaycount" -->" size="20" />
                                </li>
                            </ol>

                            <div class="warning"><b>Note:</b>
                                <ul>
                                    <li>The subscription <b>must</b> be associated with a bibliographic record.</li>
                                    <li>You <b>must</b> select a vendor if you wish to generate claims.</li>
                                </ul>
                            </div>
                        </fieldset>
                        <fieldset class="action">
                            <input type="button" value="Next >>" onclick="if ( Check_page1() ) show_page_2();" style="float:right;" />
                        </fieldset>
                    </div>
                </div>

                <div id="page_2">
                    <div class="yui-u first">
                        <div id="subscription_form_planning">
                            <fieldset class="rows">
                                <legend>Serials planning</legend>
                                <ol>
                                    <li>
                                        <label for="firstacquidate">First issue publication date: (*)</label>
                                        <!-- TMPL_UNLESS NAME='more_than_one_serial' -->
                                          <input type="text" name="firstacquidate" value="<!-- TMPL_VAR name="firstacquidate" -->" size="13" maxlength="10" id="acqui_date" readonly="readonly" />
                                          <img src="<!-- TMPL_VAR Name="themelang" -->/lib/calendar/cal.gif" id="button2" style="cursor: pointer;" alt="Show Calendar" title="Show Calendar" />
                                          <!-- both scripts for calendar must follow the input field --> 
                                          <script type="text/javascript">
                                              Calendar.setup({
                                                  inputField:"acqui_date",
                                                  ifFormat       :   "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                  button         :   "button2",
                                                  align          :   "Tl"
                                              });
                                          </script>
                                          <script type="text/javascript">
                                              Calendar.setup({
                                                  inputField     :   "acqui_date",
                                                  ifFormat       :   "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                  button         :   "acqui_date",
                                                  align          :   "Tl"
                                              });
                                          </script>
                                        <!-- TMPL_ELSE -->
                                          <!-- TMPL_VAR NAME='firstacquidate' -->
                                          <input type="hidden" id="acqui_date" name="firstacquidate" value="<!-- TMPL_VAR NAME='firstacquidate' -->" />
                                        <!-- /TMPL_UNLESS -->
                                    </li>
                                    <!-- TMPL_IF NAME='more_than_one_serial' -->
                                      <li>
                                        <label for="nextacquidate">Next issue publication date:</label>
                                        <input type="text" id="nextacquidate" name="nextacquidate" size="13" readonly="readonly" value="<!-- TMPL_VAR NAME='nextacquidate' -->" />
                                        <img src="<!-- TMPL_VAR Name='themelang' -->/lib/calendar/cal.gif" id="nextacquidatebutton" style="cursor: pointer;" alt="Show Calendar" title="Show Calendar" />
                                        <script type="text/javascript">
                                          Calendar.setup({
                                            inputField: "nextacquidate",
                                            ifFormat: "<!-- TMPL_VAR NAME='DHTMLcalendar_dateformat' -->",
                                            button: "nextacquidatebutton",
                                            align: "Tl"
                                          });
                                        </script>
                                        <script type="text/javascript">
                                          Calendar.setup({
                                            inputField: "nextacquidate",
                                            ifFormat: "<!-- TMPL_VAR NAME='DHTMLcalendar_dateformat' -->",
                                            button: "nextacquidate",
                                            align: "Tl"
                                          });
                                        </script>
                                      </li>
                                    <!-- /TMPL_IF -->
                                    <li>
                                        <label for="frequency">Frequency: (*)</label>
                                        <select name="frequency" size="1" id="frequency">
                                            <option value="">-- please choose --</option>
                                            <!--TMPL_LOOP Name="frequencies"-->
                                                <option value="<!--TMPL_VAR Name="id"-->" <!--TMPL_IF name="selected"--> selected="selected" <!-- /TMPL_IF -->>
                                                    <!--TMPL_VAR Name="label"-->
                                                </option>
                                            <!--/TMPL_LOOP-->
                                        </select>
                                    </li>
                                    <li>
                                        <label for="manuallist"> Manual history:</label>
                                        <input type="checkbox" name="manualhist" id="manuallist" value="1" />
                                    </li>
                                    <li>
                                        <label for="subtype">Subscription length:</label>
                                        <select name="subtype" id="subtype">
                                            <!-- TMPL_LOOP NAME="subtype" -->
                                                <option value="<!-- TMPL_VAR NAME="name" -->" <!-- TMPL_IF NAME="selected" --> selected="selected" <!-- /TMPL_IF --> >
                                                    <!-- TMPL_VAR NAME="name" -->
                                                </option>
                                            <!-- /TMPL_LOOP -->
                                        </select>
                                        <input type="text" name="sublength" id="sublength" value="<!-- TMPL_VAR name="sublength" -->" size="3" /> (enter amount in numerals)
                                        <input type="hidden" name="issuelengthcount">
                                    </li>
                                    <li>
                                        <label for="startdate"> Subscription start date: (*)</label>
                                        <input type="text" name="startdate" value="<!-- TMPL_VAR name="startdate" -->" size="13" maxlength="10" id="beginning_date" readonly="readonly" />
                                        <img src="<!-- TMPL_VAR Name="themelang" -->/lib/calendar/cal.gif" id="button1" style="cursor: pointer;" alt="Show Calendar" title="Show Calendar" />
                                        <!-- both scripts for calendar must follow the input field --> 
                                        <script type="text/javascript">
                                            Calendar.setup({
                                                inputField   : "beginning_date",
                                                ifFormat     : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                button       : "button1",
                                                align        : "Tl"
                                            });
                                        </script>
                                        <script type="text/javascript">
                                            Calendar.setup({
                                                inputField   : "beginning_date",
                                                ifFormat     : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                button       : "beginning_date",
                                                align        : "Tl"
                                            });
                                        </script>
                                    </li>
                                    <li>
                                        <label for="enddate">Subscription end date:</label>
                                        <input type="text" name="enddate" value="<!-- TMPL_VAR name="enddate" -->" size="13" maxlength="10" id="enddate" readonly="readonly" />
                                        <a title="Clear" style="cursor:pointer" onclick="Clear('enddate');">&Chi;</a>
                                        <img src="<!-- TMPL_VAR Name="themelang" -->/lib/calendar/cal.gif" id="button3" style="cursor: pointer;" alt="Show Calendar" title="Show Calendar" />
                                        <!-- both scripts for calendar must follow the input field --> 
                                        <script type="text/javascript">
                                            Calendar.setup({
                                                inputField   : "enddate",
                                                ifFormat     : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                button       : "button3",
                                                align        : "Tl"
                                            });
                                        </script>
                                        <script type="text/javascript">
                                            Calendar.setup({
                                                inputField   : "enddate",
                                                ifFormat     : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                                button       : "enddate",
                                                align        : "Tl"
                                            });
                                        </script>
                                    </li>
                                    <li>
                                        <label for="numberpattern"> Numbering pattern:</label>
                                        <select name="numbering_pattern" size="1" id="numberpattern">
                                            <option value="">-- please choose --</option>
                                            <!--TMPL_LOOP Name="numberpatterns"-->
                                                <option value="<!--TMPL_VAR Name="id"-->" <!--TMPL_IF name="selected"--> selected="selected" <!-- /TMPL_IF -->><!--TMPL_VAR Name="label"--></option>
                                            <!--/TMPL_LOOP-->
                                        </select>
                                    </li>
                                    <li id="more_options">
                                        <table id="moreoptionst">
                                            <thead>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th id="headerX">&nbsp;</th>
                                                    <th id="headerY">&nbsp;</th>
                                                    <th id="headerZ">&nbsp;</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                      <!-- TMPL_IF NAME='more_than_one_serial' -->
                                                        Last value
                                                      <!-- TMPL_ELSE -->
                                                        Begins with
                                                      <!-- /TMPL_IF -->
                                                    </td>
                                                    <td id="beginsX"><input type="text" id="lastvaluetemp1" name="lastvaluetemp1" value="<!-- TMPL_VAR NAME='lastvalue1' -->" /></td>
                                                    <td id="beginsY"><input type="text" id="lastvaluetemp2" name="lastvaluetemp2" value="<!-- TMPL_VAR NAME='lastvalue2' -->" /></td>
                                                    <td id="beginsZ"><input type="text" id="lastvaluetemp3" name="lastvaluetemp3" value="<!-- TMPL_VAR NAME='lastvalue3' -->" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Inner counter</td>
                                                    <td id="innerX"><input type="text" id="innerlooptemp1" name="innerlooptemp1" value="<!-- TMPL_VAR NAME='innerloop1' -->" /></td>
                                                    <td id="innerY"><input type="text" id="innerlooptemp2" name="innerlooptemp2" value="<!-- TMPL_VAR NAME='innerloop2' -->" /></td>
                                                    <td id="innerZ"><input type="text" id="innerlooptemp3" name="innerlooptemp3" value="<!-- TMPL_VAR NAME='innerloop3' -->" /></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </li>
                                    <li><a style="cursor:pointer" onclick="toggleAdvancedPattern();">Show/Hide advanced pattern</a></li>
                                    <div id="advancedpredictionpattern" style="display:none">
                                      <li>
                                        <label for="patternname">Pattern name: (*)</label>
                                        <input id="patternname" name="patternname" type="text" readonly="readonly" />
                                      </li>
                                      <li>
                                        <label for="numberingmethod">Numbering formula:</label>
                                        <input readonly="readonly" type="text" name="numberingmethod" id="numberingmethod" size="50" value="<!-- TMPL_VAR name="numberingmethod" -->" />
                                      </li>
                                        <table id="advancedpredictionpatternt">
                                            <thead>
                                                <tr>
                                                    <th colspan="4">Advanced prediction pattern</td>
                                                </tr>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th>X</th>
                                                    <th>Y</th>
                                                    <th>Z</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Label</td>
                                                    <td><input type="text" readonly="readonly" id="label1" name="label1" /></td>
                                                    <td><input type="text" readonly="readonly" id="label2" name="label2" /></td>
                                                    <td><input type="text" readonly="readonly" id="label3" name="label3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Begins with</td>
                                                    <td><input type="text" readonly="readonly" id="lastvalue1" name="lastvalue1" /></td>
                                                    <td><input type="text" readonly="readonly" id="lastvalue2" name="lastvalue2" /></td>
                                                    <td><input type="text" readonly="readonly" id="lastvalue3" name="lastvalue3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Add</td>
                                                    <td><input type="text" readonly="readonly" id="add1" name="add1" /></td>
                                                    <td><input type="text" readonly="readonly" id="add2" name="add2" /></td>
                                                    <td><input type="text" readonly="readonly" id="add3" name="add3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Every</td>
                                                    <td><input type="text" readonly="readonly" id="every1" name="every1" /></td>
                                                    <td><input type="text" readonly="readonly" id="every2" name="every2" /></td>
                                                    <td><input type="text" readonly="readonly" id="every3" name="every3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Set back to</td>
                                                    <td><input type="text" readonly="readonly" id="setto1" name="setto1" /></td>
                                                    <td><input type="text" readonly="readonly" id="setto2" name="setto2" /></td>
                                                    <td><input type="text" readonly="readonly" id="setto3" name="setto3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>When more than</td>
                                                    <td><input type="text" readonly="readonly" id="whenmorethan1" name="whenmorethan1" /></td>
                                                    <td><input type="text" readonly="readonly" id="whenmorethan2" name="whenmorethan2" /></td>
                                                    <td><input type="text" readonly="readonly" id="whenmorethan3" name="whenmorethan3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Inner counter</td>
                                                    <td><input type="text" readonly="readonly" id="innerloop1" name="innerloop1" /></td>
                                                    <td><input type="text" readonly="readonly" id="innerloop2" name="innerloop2" /></td>
                                                    <td><input type="text" readonly="readonly" id="innerloop3" name="innerloop3" /></td>
                                                </tr>
                                                <tr>
                                                    <td>Numbering</td>
                                                    <td><input type="text" readonly="readonly" id="numbering1" name="numbering1" /></td>
                                                    <td><input type="text" readonly="readonly" id="numbering2" name="numbering2" /></td>
                                                    <td><input type="text" readonly="readonly" id="numbering3" name="numbering3" /></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <input id="modifyadvancedpatternbutton" type="button" value="Modify pattern" onclick="modifyAdvancedPattern();" />
                                        <input id="restoreadvancedpatternbutton" type="button" value="Cancel modifications" onclick="restoreAdvancedPattern();" style="display:none" />
                                        <input id="testadvancedpatternbutton" type="button" value="Test advanced pattern" onclick="testAdvancedPattern();" style="display:none" />
                                        <input id="saveadvancedpatternbutton" type="button" value="Save as new pattern" onclick="saveAdvancedPattern();" style="display:none" />
                                    </div>
                                </ol>
                            </fieldset>
                            <fieldset class="action">
                                <input type="button" value="<< Previous" onclick="show_page_1();" style="float:left;"/>
                                <input id="testpatternbutton" type="button" value="Test prediction pattern" onclick="testPredictionPattern();" />
                                <input type="button" value="Save subscription" onclick="if (Check_page2()) submit();" style="float:right;" accesskey="w" />
                            </fieldset>
                        </div>
                    </div>
                    <div class="yui-u">
                        <li id="displayexample"></li>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
