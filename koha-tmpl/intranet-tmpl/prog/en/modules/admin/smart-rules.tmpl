<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Administration &rsaquo; Circulation and Fine Rules</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->

<link href="/content/ui-lightness/jquery-ui-1.8.1.custom.css" rel="stylesheet" />
<script src="/scripts/jquery-ui-1.8.1.custom.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/intranet-tmpl/prog/en/lib/jquery/plugins/jquery.uitablefilter.js"></script>
<script type="text/javascript" src="/intranet-tmpl/prog/en/lib/jquery/plugins/ui.tabs.js"></script>
<script src="/intranet-tmpl/prog/en/lib/jquery/plugins/jeditable/jquery.jeditable.js" type="text/javascript" charset="utf-8"></script>
<script src="/intranet-tmpl/prog/en/lib/jquery/plugins/jeditable/jquery.jeditable.datepicker.js" type="text/javascript" charset="utf-8"></script>
<script src="/intranet-tmpl/prog/en/lib/jquery/plugins/jeditable/js/jquery.datePicker.js" type="text/javascript" charset="utf-8"></script>

<link rel="stylesheet" type="text/css" href="/intranet-tmpl/prog/en/lib/jquery/plugins/jeditable/css/datePicker.css" />
<link rel="stylesheet" type="text/css" href="/intranet-tmpl/prog/en/lib/jquery/plugins/ui.tabs.css" />

<script type="text/javascript">
//<![CDATA[
$(document).ready(function() {
        $('#selectlibrary').find("input:submit").hide();
        $('#branchcode').change(function() {
                $('#selectlibrary').submit();
        });
        $('#filter').keyup(function() {
                $.uiTableFilter( $('#smartrules'), this.value );
        });
        $('#nofilter').click(function() {
            $('.issues').show();
            $('.fines').show();
            $('.reserves').show();
            $('.issues :input').removeAttr('disabled',true);
            $('.fines :input').removeAttr('disabled',true);
            $('.reserves :input').removeAttr('disabled',true);
            $(this).parent().attr('class','ui-tabs-selected');
            $('#issuesfilter').parent().attr('class',null);
            $('#finesfilter').parent().attr('class',null);
            $('#reservesfilter').parent().attr('class',null);
        });
        $('#issuesfilter').click(function() {
            $('.issues').show();
            $('.fines').hide();
            $('.reserves').hide();
            $('.issues :input').removeAttr('disabled',true);
            $('.fines :input').attr('disabled',true);
            $('.reserves :input').attr('disabled',true);
            $(this).parent().attr('class','ui-tabs-selected');
            $('#nofilter').parent().attr('class',null);
            $('#finesfilter').parent().attr('class',null);
            $('#reservesfilter').parent().attr('class',null);
        });
        $('#finesfilter').click(function() {
            $('.issues').hide();
            $('.fines').show();
            $('.reserves').hide();
            $('.issues :input').attr('disabled',true);
            $('.fines :input').removeAttr('disabled',true);
            $('.reserves :input').attr('disabled',true);
            $(this).parent().attr('class','ui-tabs-selected');
            $('#issuesfilter').parent().attr('class',null);
            $('#nofilter').parent().attr('class',null);
            $('#reservesfilter').parent().attr('class',null);
        });
        $('#reservesfilter').click(function() {
            $('.issues').hide();
            $('.fines').hide();
            $('.reserves').show();
            $('.issues :input').attr('disabled',true);
            $('.fines :input').attr('disabled',true);
            $('.reserves :input').removeAttr('disabled',true);
            $(this).parent().attr('class','ui-tabs-selected');
            $('#issuesfilter').parent().attr('class',null);
            $('#finesfilter').parent().attr('class',null);
            $('#nofilter').parent().attr('class',null);
        });
        $('.editabledatepicker').editable('/cgi-bin/koha/admin/smart-rules-service.pl', {
             submitdata   : {branchcode   : $('#branchcode').val(),
                            categorycode : $(this).parent('td').children('td.categorycode').children('span').text(),
                            itemtype     : $(this).parent('td').children('td.itemtype').children('span').text()},
             id           : 'varname' ,
             name         : 'inputvalue',
                type: 'datepicker',
                onblur: 'submit',
                tooltip: _("Click to edit....")
        });
        $('.datecompare').editable('/cgi-bin/koha/admin/smart-rules-service.pl', { 
             submitdata   : {branchcode   : $('#branchcode').val(),
                            categorycode : $(this).parent('td').children('td.categorycode').children('span').text(),
                            itemtype     : $(this).parent('td').children('td.itemtype').children('span').text()},
             id           : 'varname' ,
             name         : 'inputvalue',
             data   : " {'':'','1':"+_('After')+",'-1':"+_('Before')+",0:"+_('Exactly On')+"}",
             type   : 'select',
             submit : 'OK'
         });
        $('.editable').editable('/cgi-bin/koha/admin/smart-rules-service.pl', { 
             submitdata   : {branchcode   : $('#branchcode').val(),
                            categorycode : $(this).parent('td').children('td.categorycode').children('span').text(),
                            itemtype     : $(this).parent('td').children('td.itemtype').children('span').text()},
             id           : 'varname' ,
             name         : 'inputvalue',
             submit : 'OK'
         });
        $('.triple').editable('/cgi-bin/koha/admin/smart-rules-service.pl', { 
             submitdata   : {branchcode   : $('#branchcode').val(),
                            categorycode : $(this).parent().parent().children('td.categorycode').children('span').text(),
                            itemtype     : $(this).parent().parent().children('td.itemtype').children('span').text()},
             id           : 'varname' ,
             name         : 'inputvalue',
             data   : " {'':'','1':"+_('Yes')+",'0':"+_('No')+"}",
             type   : 'select',
             submit : 'OK'
         });
});
//]]>
</script>
<!-- Enable Calendar system -->
<!-- End Calendar system additions -->
</head>
<body>
<!-- TMPL_INCLUDE NAME="header.inc" -->
<!-- TMPL_INCLUDE NAME="cat-search.inc" -->

<div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/admin/admin-home.pl">Administration</a> &rsaquo; Circulation and Fine Rules</div>

<div id="doc3" class="yui-t1">

<div id="bd">
    <div id="yui-main">
    <div class="yui-b">
    <h1 class="parameters">
        <!-- TMPL_IF NAME="humanbranch" -->
            Defining circulation and fine rules for "<!-- TMPL_VAR NAME="humanbranch" -->"
        <!-- TMPL_ELSE -->
            Defining circulation and fine rules for all libraries
        <!-- /TMPL_IF -->
    </h1>
    <div id="bloc100">
        <form method="get" action="/cgi-bin/koha/admin/smart-rules.pl" id="selectlibrary">
        Select a library :
            <select name="branchcode" id="branchcode" style="width:20em;">
                <option value="*">Default</option>
            <!-- TMPL_LOOP NAME="branchloop" -->
				<!-- TMPL_IF NAME="selected" --><option value="<!-- TMPL_VAR NAME="value" -->" selected="selected"><!-- TMPL_VAR NAME="branchname" --></option><!-- TMPL_ELSE --><option value="<!-- TMPL_VAR NAME="value" -->"><!-- TMPL_VAR NAME="branchname" --></option><!-- /TMPL_IF -->
            <!-- /TMPL_LOOP -->
            </select>
        </form>
<!-- TMPL_IF Name="definedbranch" --><form action="/cgi-bin/koha/admin/clone-rules.pl" method="post"><label 
for="tobranch"><strong>Clone these rules to:</strong></label> <input type="hidden" name="frombranch" value="<!-- TMPL_VAR NAME="current_branch" -->" />
            <select name="tobranch" id="tobranch"><!-- TMPL_LOOP NAME="branchloop" --><option value="<!-- TMPL_VAR NAME="value" -->"><!-- TMPL_VAR NAME="branchname" --></option><!-- /TMPL_LOOP --></select> <input type="submit" value="Clone" /></form><!-- /TMPL_IF --></fieldset>

        <div class="toptabs">
            <ul class="ui-tabs-nav">
                <li class="ui-tabs-selected"><a id="nofilter">All</a></li>
                <li><a id="issuesfilter">Issues</a></li>
                <li><a id="finesfilter">Fines</a></li>
                <li><a id="reservesfilter">Reserves</a></li>
                <div style="text-align:right;">
                    <label for="filter" style="float:none;">Filter: </label>
                    <input type="text" name="filter" id="filter" />
                </div>
            </ul>
            <div class="tabs-container">
                    <table id="smartrules" width="100%">
                        <thead>
                            <tr>
                                <th>Patron category</th>
                                <th>Item type</th>
                                <th class="issues">Current checkouts allowed</th>
                                <th class="issues">Loan period (day)</th>
                                <th class="issues">Hard Due Date Compare</th>
                                <th class="issues">Hard Due Date</th>
                                <th class="fines">Fine amount</th>
                                <th class="fines">Fine charging interval</th>
                                <th class="fines">Grace period (day)</th>
                                <th class="fines">Suspension duration (day)</th>
                                <th class="issues">Renewals allowed (count)</th>
                                <th class="issues">Renewals period (days)</th>
                                <th class="reserves">Holds allowed (count)</th>
                                <th class="reserves">Holds pickup delay (day)</th>
                                <th class="reserves">Allow on shelf holds</th>
                                <th class="reserves">Holds restricted to library</th>
                                <th class="issues">Rental Discount (%)</th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                        <!-- TMPL_LOOP NAME="rules" -->
                            <!-- TMPL_UNLESS NAME="__odd__" -->
                            <tr class="highlight">
                            <!-- TMPL_ELSE -->
                            <tr>
                            <!-- /TMPL_UNLESS -->
                                    <td class="categorycode">
                                        <span style="display:none;"><!-- TMPL_VAR NAME="categorycode" --></span>
                                        <!-- TMPL_IF NAME="default_humancategorycode" -->
                                            <em>Default</em>
                                        <!-- TMPL_ELSE -->
                                            <!-- TMPL_VAR NAME="humancategorycode" -->
                                        <!-- /TMPL_IF -->
                                    </td>
                                    <td class="itemtype">
                                        <span style="display:none;"><!-- TMPL_VAR NAME="itemtype" --></span>
                                        <!-- TMPL_IF NAME="default_humanitemtype" -->
                                            <em>Default</em>
                                        <!-- TMPL_ELSE -->
                                            <!-- TMPL_VAR NAME="humanitemtype" -->
                                        <!-- /TMPL_IF -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_maxissueqty" -->
                                    <td class="maxissueqty editable issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="issues">
                                    <!-- /TMPL_IF -->
                                        <!-- TMPL_IF NAME="unlimited_maxissueqty" -->
                                            Unlimited
                                        <!-- TMPL_ELSE -->
                                            <!-- TMPL_VAR NAME="maxissueqty" -->
                                        <!-- /TMPL_IF -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_issuelength" -->
                                    <td class="issuelength editable issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="issuelength editable issues">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="issuelength" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_hardduedatecompare" -->
                                    <td class="hardduedatecompare issues datecompare herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="hardduedatecompare issues datecompare">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="hardduedatecompare" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_hardduedate" -->
                                    <td class="hardduedate editabledatepicker issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="hardduedate editabledatepicker issues">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="hardduedate" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_fine" -->
                                    <td class="fine editable fines herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="fine editable fines">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="fine" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_chargeperiod" -->
                                    <td class="chargeperiod editable fines herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="chargeperiod editable fines">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="chargeperiod" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_firstremind" -->
                                    <td class="firstremind editable fines herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="firstremind editable fines">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="firstremind" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_finedays" -->
                                    <td class="finedays editable fines herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="finedays editable fines">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="finedays" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_renewalsallowed" -->
                                    <td class="renewalsallowed editable issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="renewalsallowed editable issues">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="renewalsallowed" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_renewalperiod" -->
                                    <td class="renewalperiod editable issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="renewalperiod editable issues">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="renewalperiod" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_reservesallowed" -->
                                    <td class="reservesallowed editable reserves herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="reservesallowed editable reserves">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="reservesallowed" -->
                                    </td>
                                     <!-- TMPL_IF NAME="herited_holdspickupdelay" -->
                                    <td class="holdspickupdelay editable reserves herited">
                                    <!--TMPL_ELSE-->
                                    <td class="holdspickupdelay editable reserves">
                                    <!--/TMPL_IF-->
                                    <!-- TMPL_VAR NAME="holdspickupdelay" -->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_allowonshelfholds" -->
                                    <td class="allowonshelfholds reserves triple herited">
                                    <!--TMPL_ELSE-->
                                    <td class="allowonshelfholds reserves triple">
				    <!--/TMPL_IF-->
                                    <!-- TMPL_IF NAME="allowonshelfholds" -->
                                    Yes
                                    <!--TMPL_ELSE-->
                                    No
                                    <!--/TMPL_IF-->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_holdrestricted" -->
                                    <td class="holdrestricted editable reserves boolean herited">
                                    <!--TMPL_ELSE-->
                                     <td class="holdrestricted editable reserves boolean">
                                    <!--/TMPL_IF-->
                                    <!-- TMPL_IF NAME="holdrestricted" -->
                                    Yes
                                    <!--TMPL_ELSE-->
                                    No
                                    <!--/TMPL_IF-->
                                    </td>
                                    <!-- TMPL_IF NAME="herited_rentaldiscount" -->
                                    <td class="rentaldiscount editable issues herited">
                                    <!-- TMPL_ELSE -->
                                    <td class="rentaldiscount editable issues">
                                    <!-- /TMPL_IF -->
                                    <!-- TMPL_VAR NAME="rentaldiscount" -->
                                    </td>
                                    <td>
                                        <a class="button" href="/cgi-bin/koha/admin/smart-rules.pl?op=delete&amp;itemtype=<!-- TMPL_VAR NAME="itemtype" -->&amp;categorycode=<!-- TMPL_VAR NAME="categorycode" -->&amp;branchcode=<!-- TMPL_VAR NAME="branchcode" -->">Delete</a>
                                    </td>
                                </tr>
                            <!-- /TMPL_LOOP -->
                        </tbody>
                        <form method="post" name="inputrules" action="/cgi-bin/koha/admin/smart-rules.pl">
                            <input type="hidden" name="op" value="add" />
                        <tfoot>
                            <tr>
                                <td>
                                    <select name="categorycode" id="categorycode" style="width:12em;">
                                        <option value="*">Default</option>
                                    <!-- TMPL_LOOP NAME="categoryloop" -->
                                        <!-- TMPL_IF Name="selected"-->
                                        <option value="<!-- TMPL_VAR NAME="categorycode" -->" selected="selected"><!-- TMPL_VAR NAME="description" --></option>
                                        <!--TMPL_ELSE --> <option value="<!-- TMPL_VAR NAME="categorycode" -->" ><!-- TMPL_VAR NAME="description" --></option>
                                        <!-- /TMPL_IF -->
                                    <!-- /TMPL_LOOP -->
                                    </select>
                                </td>
                                <td>
                                    <select name="itemtype" style="width:12em;">
                                        <option value="*">Default</option>
                                    <!-- TMPL_LOOP NAME="itemtypeloop" -->
                                        <!-- TMPL_IF Name="selected"-->
                                        <option value="<!-- TMPL_VAR NAME="itemtype" -->" selected="selected"><!-- TMPL_VAR NAME="description" --></option>
                                        <!--TMPL_ELSE --> <option value="<!-- TMPL_VAR NAME="itemtype" -->"><!-- TMPL_VAR NAME="description" --></option>
                                        <!-- /TMPL_IF -->
                                    <!-- /TMPL_LOOP -->
                                    </select>
                                </td>
                                <td class="issues"><input name="maxissueqty" size="3" value="<!-- TMPL_VAR NAME="maxissueqty" -->"/></td>
                                <td class="issues"><input name="issuelength" size="3" value="<!-- TMPL_VAR NAME="issuelength" -->"/> </td>
                                <td class="issues"><select name="hardduedatecompare" >
                                                        <option value="-1">Before</option>
                                                        <option value="0">Exactly on</option>
                                                        <option value="1">After</option>
                                                   </select>
                                    </td>
                                <td class="issues">
                                    <input type="text" size="10" name="hardduedate" value="<!-- TMPL_VAR NAME="hardduedate" -->" />
                                 </td>
                                <td class="fines"><input name="fine" size="4" value="<!-- TMPL_VAR NAME="fine" -->"/></td>
                                <td class="fines"><input name="chargeperiod" size="2" value="<!-- TMPL_VAR NAME="chargeperiod" -->"/></td>
                                <td class="fines"><input name="firstremind" size="2" value="<!-- TMPL_VAR NAME="firstremind" -->"/> </td>
                                <td class="fines"><input name="finedays" size="3" value="<!-- TMPL_VAR NAME="finedays" -->"/> </td>
                                <td class="issues"><input name="renewalsallowed" size="2" value="<!-- TMPL_VAR NAME="renewalsallowed" -->"/></td>
                                <td class="issues"><input name="renewalperiod" size="2" value="<!-- TMPL_VAR NAME="renewalperiod" -->"/></td>
                                <td class="reserves"><input name="reservesallowed" size="2" value="<!-- TMPL_VAR NAME="reservesallowed" -->"/></td>
                                <td class="reserves"><input name="holdspickupdelay" size="2" value="<!-- TMPL_VAR NAME="holdspickupdelay" -->"/></td>
                                <td class="reserves">
                                    <select name="allowonshelfholds">
                                        <option value=""></option>
                                        <option value="1">Yes</option>
                                        <option value="0">No</option>
                                    </select>
                                </td>
                                <td class="reserves"><!-- TMPL_IF NAME="holdrestricted"--><input type="checkbox" name="holdrestricted" checked="checked" value="1"/> <!--TMPL_ELSE--><input type="checkbox" name="holdrestricted" value="1"/> <!-- /TMPL_IF --></td>
		                        <td class="issues"><input name="rentaldiscount" size="2" /></td>
                                <td><input type="hidden" name="branchcode" value="<!-- TMPL_VAR NAME="branchcode" -->"/><input type="submit" value="Add" class="submit" /></td>
                            </tr>
                        </tfoot>
                </form>
                    </table>
            </div><!-- tabs-container -->
        </div><!-- toptabs -->
    </div>
</div>

</div>
<div class="yui-b">
<!-- TMPL_INCLUDE NAME="admin-menu.inc" -->
</div>
</div>
<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
